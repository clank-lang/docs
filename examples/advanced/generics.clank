// Advanced Generics
// Demonstrates: type parameters, constraints, higher-kinded types

// Basic generic function
Æ’ identity[T](x: T) â†’ T {
  x
}

// Multiple type parameters
Æ’ pair[A, B](a: A, b: B) â†’ (A, B) {
  (a, b)
}

// Constrained generics â€” T must implement Ord
Æ’ max[T: Ord](a: T, b: T) â†’ T {
  if a > b { a } else { b }
}

// Multiple constraints
Æ’ show_max[T: Ord + Show](a: T, b: T) â†’ ð•Š {
  show(max(a, b))
}

// Generic data structures
sum Option[T] {
  Some(T),
  None
}

sum Result[T, E] {
  Ok(T),
  Err(E)
}

rec Pair[A, B] {
  first: A,
  second: B
}

// Generic functions on generic types
Æ’ map_option[T, U](opt: Option[T], f: (T) â†’ U) â†’ Option[U] {
  match opt {
    Some(x) â†’ Some(f(x)),
    None â†’ None
  }
}

Æ’ flat_map_option[T, U](opt: Option[T], f: (T) â†’ Option[U]) â†’ Option[U] {
  match opt {
    Some(x) â†’ f(x),
    None â†’ None
  }
}

Æ’ map_result[T, U, E](res: Result[T, E], f: (T) â†’ U) â†’ Result[U, E] {
  match res {
    Ok(x) â†’ Ok(f(x)),
    Err(e) â†’ Err(e)
  }
}

Æ’ map_error[T, E, F](res: Result[T, E], f: (E) â†’ F) â†’ Result[T, F] {
  match res {
    Ok(x) â†’ Ok(x),
    Err(e) â†’ Err(f(e))
  }
}

// Functor-like operations on arrays
Æ’ map[T, U](arr: [T], f: (T) â†’ U) â†’ [U] {
  let mut result: [U] = []
  for item âˆˆ arr {
    result = result ++ [f(item)]
  }
  result
}

Æ’ filter[T](arr: [T], pred: (T) â†’ ð”¹) â†’ [T] {
  let mut result: [T] = []
  for item âˆˆ arr {
    if pred(item) {
      result = result ++ [item]
    }
  }
  result
}

Æ’ fold[T, U](arr: [T], init: U, f: (U, T) â†’ U) â†’ U {
  let mut acc = init
  for item âˆˆ arr {
    acc = f(acc, item)
  }
  acc
}

// Chained transformations
Æ’ process(numbers: [â„¤]) â†’ â„¤ {
  numbers
    |> filter(Î»n â†’ n > 0)
    |> map(Î»n â†’ n Ã— 2)
    |> fold(0, Î»(a, b) â†’ a + b)
}

Æ’ main() â†’ IO[()] {
  let nums = [1, -2, 3, -4, 5]
  println("Processed: " ++ str(process(nums)))

  let opt = Some(42)
  let doubled = map_option(opt, Î»n â†’ n Ã— 2)
  println("Doubled: " ++ show(doubled))
}
